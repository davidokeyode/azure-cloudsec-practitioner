# Function to display formatted messages
function Display-Message {
    param (
        [string]$message
    )
    Write-Host -ForegroundColor Green $message
}

# Retrieve UPN suffix and construct user name
$upnsuffix = (az ad signed-in-user show --query userPrincipalName --output tsv) -replace '.*@'
$user = "victimadminuser@$upnsuffix"

# Delete Admin User
Display-Message "Removing the user $user"
Remove-AzADUser -UserPrincipalName $user -Confirm:$False -Force

# Delete Resource Group
$group = "pentest-rg"
Display-Message "Removing the resource group $group"
az group delete -n $group -y

# Script Output
Display-Message "Successfully deleted the user $user"
Display-Message "Successfully deleted the resource group $group"
