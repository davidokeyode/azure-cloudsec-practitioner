
### Run from Pentest VM
1. Within the RDP session of your pentest VM, open a PowerShell console as an administrator

2. Import the MicroBurst module into your PowerShell session with the following commands:
* If you receive some error messages about AzureRm, please ignore (AzureRm is deprecated and will be removed in a future release)
```
cd "$env:SystemDrive\PentestTools\Azure\Attack\MicroBurst"
Import-Module .\MicroBurst.psm1
```

3. Use the Invoke-EnumerateAzureSubDomains function to identify potential targets that have a base name of **`azpentestenvXX`** (where XX is your student number): 
```
Invoke-EnumerateAzureSubDomains -Base azpentestenvXX
```

4. As we can see in this example, the resulting output table indicates that there are Azure platform service instances with the **`azpentestenvXX`** resource name. These targets have been pre-provisioned for you to use in this lab. They are hosted in your designated Azure subscription.
* Be careful not to target any other Azure resources that are not in your designated Azure subscription or in a subscription that does not belong to you!

### Identifying misconfigured blob containers using MicroBurst
* Configuration-related vulnerabilities can cause serious problems in Azure environments.
* In this exercise, we will use the **`Invoke-EnumerateAzureBlobs`** script from **`MicroBurst`** to access data in a misconfigured Azure Blob storage service. 
  * **Task 1**: Use the **`Invoke-EnumerateAzureBlobs`** MicroBurst module to anonymously enumerate storage account containers using the azurepentesting base name and the built-in permutation list.
  * **Task 2**: Define a custom container list and use it to enumerate further containers.

1. Use the **`Invoke-EnumerateAzureBlobs`** function with a base word of  **`azpentestenvXX`** (where XX is your student number). 
   * MicroBurst will identify public storage accounts with containers that have the container access level configured:
```
Invoke-EnumerateAzureBlobs -Base azpentestenvXX
```

2. We can then download and read the contents of the objects directly using the following commands:
```
Invoke-WebRequest -Uri "https://azpentestenvXX.blob.core.windows.net/public/README.md" -OutFile "README.md"

Get-Content .\README.md

Invoke-WebRequest -Uri "https://azpentestenvXX.blob.core.windows.net/private/sensitive_customer_private_information.csv" -OutFile "sensitive_customer_private_information.csv"

Get-Content .\sensitive_customer_private_information.csv
```

3. In the command we used in **`Step 2`**, MicroBurst enumerated the storage account using common container names such as private and public. Review the permutable list of containers that MicroBurst uses by default. We can modify this list to include additional container names that we want to attempt.
```
Get-Content .\Misc\permutations.txt
```
* Unless otherwise specified in the command, the names used for the container name guesses will come from the permutations.txt file in the MicroBurst repository.

4. MicroBurst also allows us to specify custom container names using the Folders parameter. Create a custom container name list and open it with notepad using the following commands:
```
New-Item -Path . -Name "customcontainerlist.txt" -ItemType "file"

notepad .\customcontainerlist.txt
```

5. Add the following names to the Notepad file. Save the file and close it:
```
scripts
templates
archive
archived
2020
2019
2018
```

6. Back in the PowerShell console, use the following command to enumerate potential public containers using any of the names in our custom name list:
```
Invoke-EnumerateAzureBlobs -Base azpentestenvXX -Folders .\customcontainerlist.txt
```

7. You can see that we have found additional public containers and objects that we did not find earlier.

